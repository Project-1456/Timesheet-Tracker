<!DOCTYPE html>
<html>
<head>
    <title>timesheet thing</title>
</head>
<body>
    <h1>work tracker</h1>
    
    <div id="nameButtons">
        <button onclick="startWork('Don')">Don</button>
        <button onclick="startWork('Ten')">Ten</button>
        <button onclick="startWork('An')">An</button>
        <button onclick="startWork('üêß')">üêß</button>
        <button onclick="startWork('G')">G</button>
    </div>
    
    <div id="workingState" style="display:none;">
        <p>working: <span id="currentName"></span></p>
        <p>started: <span id="startTime"></span></p>
        <button onclick="endWork()">end</button>
    </div>
    
    <h2>weekly totals</h2>
    <div id="weeklyTotals"></div>
    
    <h2>timesheets</h2>
    <div id="timesheets"></div>

    <script>
        let timesheets = JSON.parse(localStorage.getItem('timesheets') || '[]');
        let currentSession = JSON.parse(localStorage.getItem('currentSession') || 'null');

        // restore session on load
        if (currentSession) {
            currentSession.startTime = new Date(currentSession.startTime);
            document.getElementById('nameButtons').style.display = 'none';
            document.getElementById('workingState').style.display = 'block';
            document.getElementById('currentName').textContent = currentSession.name;
            document.getElementById('startTime').textContent = currentSession.startTime.toLocaleString();
        }

        displayTimesheets();

        function startWork(name) {
            const startTime = new Date();
            const companyTime = new Date(startTime.toLocaleString("en-US", {timeZone: "Asia/Shanghai"}));
            currentSession = { name, startTime: companyTime };
            localStorage.setItem('currentSession', JSON.stringify(currentSession));
            
            document.getElementById('nameButtons').style.display = 'none';
            document.getElementById('workingState').style.display = 'block';
            document.getElementById('currentName').textContent = name;
            document.getElementById('startTime').textContent = companyTime.toLocaleString();
        }

        function endWork() {
            if (!currentSession) return;
            
            const endTime = new Date();
            const companyEndTime = new Date(endTime.toLocaleString("en-US", {timeZone: "Asia/Shanghai"}));
            const duration = Math.round((companyEndTime - currentSession.startTime) / 1000 / 60);
            
            timesheets.push({
                name: currentSession.name,
                start: currentSession.startTime.toLocaleString(),
                end: companyEndTime.toLocaleString(),
                minutes: duration
            });
            
            localStorage.setItem('timesheets', JSON.stringify(timesheets));
            localStorage.removeItem('currentSession');
            
            currentSession = null;
            document.getElementById('nameButtons').style.display = 'block';
            document.getElementById('workingState').style.display = 'none';
            
            displayTimesheets();
        }

        function displayTimesheets() {
            const container = document.getElementById('timesheets');
            container.innerHTML = '';
            
            timesheets.forEach(sheet => {
                const div = document.createElement('div');
                div.innerHTML = `${sheet.name} - ${sheet.start} to ${sheet.end} (${sheet.minutes} mins)<br>`;
                container.appendChild(div);
            });

            displayWeeklyTotals();
        }

        function displayWeeklyTotals() {
            const container = document.getElementById('weeklyTotals');
            container.innerHTML = '';

            const weeklyTotals = {};
            
            timesheets.forEach(sheet => {
                const startDate = new Date(sheet.start);
                const weekStart = getWeekStart(startDate);
                const weekKey = `${sheet.name}-${weekStart.toDateString()}`;
                
                if (!weeklyTotals[weekKey]) {
                    weeklyTotals[weekKey] = {
                        name: sheet.name,
                        weekStart: weekStart,
                        minutes: 0
                    };
                }
                weeklyTotals[weekKey].minutes += sheet.minutes;
            });

            Object.values(weeklyTotals).forEach(total => {
                const hours = Math.floor(total.minutes / 60);
                const mins = total.minutes % 60;
                const div = document.createElement('div');
                div.innerHTML = `${total.name} - week of ${total.weekStart.toDateString()}: ${hours}h ${mins}m<br>`;
                container.appendChild(div);
            });
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }
    </script>
</body>
</html>